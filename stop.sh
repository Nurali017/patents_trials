#!/bin/bash

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Trials —Å–µ—Ä–≤–∏—Å–æ–≤"
echo "============================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
RUNNING_CONTAINERS=$(docker ps --filter "name=trials_" --format "{{.Names}}" | wc -l | tr -d ' ')

if [ "$RUNNING_CONTAINERS" = "0" ]; then
    echo "‚ÑπÔ∏è  –ù–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Trials"
    exit 0
fi

echo "üìã –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:"
docker ps --filter "name=trials_" --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
echo ""

# –°–ø—Ä–∞—à–∏–≤–∞–µ–º —á—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
echo "–ß—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?"
echo "1. –í—Å—ë (–ë–î + –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)"
echo "2. –¢–æ–ª—å–∫–æ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å"
echo "3. –¢–æ–ª—å–∫–æ –ë–î"
echo "4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–≤–∫–ª—é—á–∞—è volumes)"
echo "0. –û—Ç–º–µ–Ω–∞"
echo ""
read -p "–í—ã–±–æ—Ä: " choice

case $choice in
    1)
        echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤..."
        docker-compose down
        echo "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
        ;;
    2)
        echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞..."
        docker-compose stop trials-service
        docker-compose rm -f trials-service
        echo "‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
        ;;
    3)
        echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë–î..."
        docker-compose stop trials-db
        docker-compose rm -f trials-db
        echo "‚úÖ –ë–î –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
        echo "‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ volume trials_postgres_data"
        ;;
    4)
        echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î!"
        read -p "–í—ã —É–≤–µ—Ä–µ–Ω—ã? (yes/no): " confirm
        if [ "$confirm" = "yes" ]; then
            echo "üóëÔ∏è  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö..."
            docker-compose down -v
            echo "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã!"
        else
            echo "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞"
        fi
        ;;
    0)
        echo "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞"
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac


















